<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>MarchÃ© en direct â€¢ MMM V10.3</title>
  <link rel="stylesheet" href="/mmm.css">
</head>

<body>
  <div class="header">ğŸ“ˆ MarchÃ© en direct</div>

  <div class="grid">
    <div class="card"><b>Status:</b> prÃªt Ã  recevoir les flux. (V10.3 API)</div>
    <div class="card">
      <div class="small">Exemple de test API :</div>
      <a class="btn" href="/api/hello" target="_blank">Appeler /api/hello</a>
    </div>
  </div>

  <!-- âœ… Ici on affichera les opportunitÃ©s rÃ©elles -->
  <div id="market-container" class="grid" style="margin-top:12px;"></div>

  <!-- âœ… Script dâ€™intÃ©gration -->
  <script type="module">
    import { getBestImage } from "./lib/getBestImage.js";

    // ğŸ” Exemple dâ€™opportunitÃ©s (remplace par tes flux)
    const items = [
      {
        title: "Peugeot 208 2018",
        type: "auto",
        url: null
      },
      {
        title: "iPhone 14 Pro",
        type: "product",
        url: null
      }
    ];

    async function renderMarket(items) {
      const container = document.getElementById("market-container");
      container.innerHTML = ""; // reset

      for (const item of items) {
        const img = await getBestImage({
          q: item.title,
          type: item.type,
          url: item.url
        });

        const card = document.createElement("div");
        card.className = "card";

        card.innerHTML = `
          <img
            src="${img.thumbUrl || img.imageUrl || "/placeholder.png"}"
            alt="${item.title}"
            style="width:100%;height:160px;object-fit:cover;border-radius:8px;margin-bottom:8px;"
          />
          <b>${item.title}</b><br/>
          <small>${item.type}</small>
          ${img.source === "ai-fallback" ? "<div class='small'>Illustration IA</div>" : ""}
        `;

        container.appendChild(card);
      }
    }

    renderMarket(items);
  </script>
</body>
</html>
