<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Money Motor Muslim â€” Tableau de bord (V10.3)</title>
  <link rel="manifest" href="/manifest.webmanifest">
  <link rel="stylesheet" href="/mmm.css">
  <meta name="theme-color" content="#0b0b0b">
</head>

<body>
  <div class="header">Money Motor Muslim â€” Tableau de bord (V10.3)</div>

  <div class="grid">
    <!-- Ã‰tat IA -->
    <div class="card">
      <div><b>Ã‰tat IA :</b> <span id="ia-badge">VÃ©rificationâ€¦</span></div>
      <div class="small">Serveur API cÃ´tÃ© Vercel â€¢ PWA installable â€¢ 100 % licite</div>
      <div style="margin-top:10px">
        <a class="btn" href="/market_live.html">ğŸ“ˆ MarchÃ© en direct</a>
        <a class="btn" href="/publish_wizard.html">ğŸ§© Assistant de publication</a>
        <a class="btn" href="/auto_publisher.html">ğŸ¤– Smart Auto-Publisher</a>
      </div>
    </div>

    <!-- Conseil instantanÃ© -->
    <div class="card">
      <div style="margin-bottom:8px;"><b>Conseil instantanÃ©</b></div>
      <input id="topic" placeholder="Ex: enchÃ¨res voitures Maroc"
        style="width:100%;padding:10px;border-radius:10px;border:1px solid #333;background:#0f0f0f;color:#f2f2f2">
      <button class="btn" id="btn-ask" style="margin-top:10px;">Obtenir un conseil</button>
      <pre id="advice" class="small"></pre>
    </div>
  </div>

  <!-- Script reliÃ© Ã  lâ€™API -->
  <script>
  (async function () {
    const badge = document.getElementById('ia-badge');
    try {
      // ğŸ‘‡ Ton API (celle qui doit rÃ©pondre {"ok":true})
      const res = await fetch('https://mmm-xs9j.vercel.app/api/status', {
        cache: 'no-store',
        mode: 'cors'
      });
      const data = await res.json();
      console.log('RÃ©ponse API:', data); // Debug
      badge.textContent = (data && data.ok) ? 'En ligne âœ…' : 'Hors ligne âŒ';
    } catch (err) {
      console.error('Erreur API:', err);
      badge.textContent = 'Hors ligne âŒ';
    }
  })();

  // Assistant de conseil instantanÃ©
  (function () {
    const input = document.getElementById('topic');
    const btn   = document.getElementById('btn-ask');
    const out   = document.getElementById('advice');
    if (!btn || !out) return;
    btn.addEventListener('click', async () => {
      const prompt = (input?.value || '').trim();
      if (!prompt) { out.textContent = 'ğŸ’¬ Ã‰cris une question.'; return; }
      out.textContent = 'â³ Je rÃ©flÃ©chisâ€¦';
      try {
        const r = await fetch('https://mmm-xs9j.vercel.app/api/advisor', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          mode: 'cors',
          body: JSON.stringify({ prompt })
        });
        const data = await r.json();
        out.textContent = data.reply || data.answer || JSON.stringify(data, null, 2);
      } catch (e) {
        out.textContent = 'âŒ ' + (e.message || 'Erreur');
      }
    });
  })();
  </script>
</body>
</html>
