<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Money Motor Muslim ‚Äî Tableau de bord (V10.3)</title>
  <link rel="manifest" href="/manifest.webmanifest">
  <link rel="stylesheet" href="/mmm.css">
  <meta name="theme-color" content="#0b0b0b">
</head>

<body>
  <div class="header">Money Motor Muslim ‚Äî Tableau de bord (V10.3)</div>

  <div class="grid">

    <!-- √âtat IA -->
    <div class="card">
      <div><b>√âtat IA :</b> <span id="ia-badge">V√©rification‚Ä¶</span></div>
      <div class="small">Serveur API c√¥t√© Vercel ‚Ä¢ PWA installable ‚Ä¢ 100 % licite</div>
      <div style="margin-top:10px">
        <a class="btn" href="/market_live.html">üìà March√© en direct</a>
        <a class="btn" href="/publish_wizard.html">üß© Assistant de publication</a>
        <a class="btn" href="/auto_publisher.html">ü§ñ Smart Auto-Publisher</a>
      </div>
    </div>

    <!-- Conseil instantan√© -->
    <div class="card">
      <div style="margin-bottom:8px;"><b>Conseil instantan√©</b></div>
      <input 
        id="topic" 
        placeholder="Ex: ench√®res voitures Maroc"
        style="width:100%;padding:10px;border-radius:10px;border:1px solid #333;background:#0f0f0f;color:#f2f2f2">
      <button class="btn" id="btn-ask" style="margin-top:10px;">Obtenir un conseil</button>
      <pre id="advice" class="small"></pre>
    </div>

  </div>

  <!-- ============================= -->
  <!-- üß† Script reli√© √† l‚ÄôAPI Money Motor Y -->
  <!-- ============================= -->

  <script>
  // --- V√©rifie l‚Äô√©tat de l‚ÄôIA ---
  (async function () {
    const badge = document.getElementById('ia-badge');
    try {
      const res = await fetch('https://mmm-xs9j.vercel.app/api/status', { cache: 'no-store' });
      const data = await res.json();
      badge.textContent = (data && data.ok) ? 'En ligne ‚úÖ' : 'Hors ligne ‚ùå';
    } catch (e) {
      badge.textContent = 'Hors ligne ‚ùå';
    }
  })();

  // --- G√®re le bouton ‚ÄúObtenir un conseil‚Äù ---
  document.getElementById('btn-ask').addEventListener('click', async () => {
    const topic = document.getElementById('topic').value.trim();
    const adviceBox = document.getElementById('advice');
    
    if (!topic) {
      adviceBox.textContent = "‚ö†Ô∏è Merci de saisir un sujet avant de demander un conseil.";
      return;
    }

    adviceBox.textContent = "‚è≥ Consultation de Money Motor Y...";

    try {
      const res = await fetch('https://mmm-xs9j.vercel.app/api/advisor', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ prompt: topic })
      });

      const data = await res.json();

      if (data.ok && data.reply) {
        adviceBox.textContent = data.reply;
      } else {
        adviceBox.textContent = "‚ùå Pas de r√©ponse de l‚ÄôIA.";
      }
    } catch (err) {
      adviceBox.textContent = "‚ö†Ô∏è Erreur de connexion √† Money Motor Y.";
    }
  });
  </script>
</body>
</html>
